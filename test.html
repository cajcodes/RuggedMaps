<html>
<head>
 <meta charset="utf-8">
 <script src="https://ajax.googleapis.com/ajax/libs/cesiumjs/1.105/Build/Cesium/Cesium.js"></script>
 <link href="https://ajax.googleapis.com/ajax/libs/cesiumjs/1.105/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
</head>

<body>
  <div id="cesiumContainer"></div>
  <script>
  window.onload = function() {
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1YjY2OWE1Yy0wYjc1LTQ1YTQtODMxZi1mZTQwOWQwOGEzZWYiLCJpZCI6MTUwODQ0LCJpYXQiOjE2ODgzNDY0MTh9.dEoQJsxp89FmreUbbxZiSjduEt9OKWZJC1jUJGCaI64';
    const viewer = new Cesium.Viewer('cesiumContainer', {
      imageryProvider: false,
      baseLayerPicker: false,
      requestRenderMode: true,
      // Hide the credit container
      creditContainer: document.createElement('div'),
      // Disable elements of the viewer
      animation: false, // Hides the animation widget
      geocoder: false, // Hides the geocoder widget
      timeline: false, // Hides the timeline widget
      sceneModePicker: false, // Hides the scene mode picker widget
      navigationHelpButton: true, // Hides the navigation help button
      homeButton: false, // Hides the home button
      infoBox: false, // Hides the infobox widget
      selectionIndicator: false, // Hides the selection indicator
    });
    
    viewer.scene.screenSpaceCameraController.enableRotate = true;
    viewer.scene.screenSpaceCameraController.enableTranslate = true;
    viewer.scene.screenSpaceCameraController.enableZoom = true;
    viewer.scene.screenSpaceCameraController.enableTilt = true;
    viewer.scene.screenSpaceCameraController.enableLook = true;

    viewer.scene.screenSpaceCameraController.rotateEventTypes = [
      Cesium.CameraEventType.LEFT_DRAG,
      Cesium.CameraEventType.RIGHT_DRAG,
      Cesium.CameraEventType.MIDDLE_DRAG
    ];
    
    const tileset = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
      url: "https://tile.googleapis.com/v1/3dtiles/root.json?key= AIzaSyA8C9_h4ZqzKWDRJNNG3677SYaZgZ9XSWg",
      showCreditsOnScreen: true,
    }));

    viewer.scene.globe.show = false;
    
    viewer.camera.flyTo({
    	destination : Cesium.Cartesian3.fromDegrees(-95.96547487377435, 30.368099017765402, 1459.354543558098),
    	duration: 5
     });

    // Define preset positions for each worker (each worker has its own path)
    const paths = [
      //Worker 1
      [
        { longitude: -95.96526686670236, latitude: 30.36809349917687 },
        { longitude: -95.96528196085884, latitude: 30.36805214884635 },
        { longitude: -95.96525500067074, latitude: 30.36806750069125 },
        { longitude: -95.96525158320776, latitude: 30.36808089164782 },
      ],
      // Worker 2
      [
        { longitude: -95.9664150657486, latitude: 30.368043552871967 },
        { longitude: -95.96636686831134, latitude: 30.36794203760904 },
        { longitude: -95.96624012988744, latitude: 30.36776609321464 },
      ],
      // Worker 3
      [
        { longitude: -95.96626741734994, latitude: 30.367502976534144 },
        { longitude: -95.96623879697727, latitude: 30.367517230000562 },
        { longitude: -95.96625421967924, latitude: 30.367530536712977 },
        { longitude: -95.96626741734994, latitude: 30.367502976534144 },
        { longitude: -95.96625623133603, latitude: 30.367471524322475 },
      ],
      // Worker 4
      [
        { longitude: -95.96559143410802, latitude: 30.367480839540896 },
        { longitude: -95.96560216294418, latitude: 30.36747621111704 },
        { longitude: -95.96560350404869, latitude: 30.367463482950296 },
        { longitude: -95.96559948073514, latitude: 30.36743571239896 },
        { longitude: -95.96559679852611, latitude: 30.367429926866436 },
        { longitude: -95.96557735251055, latitude: 30.36741777724704 },
        { longitude: -95.96555053042017, latitude: 30.367429926866436 },
        { longitude: -95.9655284021956, latitude: 30.36743802661187 },
      ],
    ];

    const colors = [
      Cesium.Color.RED,
      Cesium.Color.GREEN,
      Cesium.Color.BLUE,
      Cesium.Color.YELLOW,
    ];

    const workers = paths.map((path, index) => ({
      entity: viewer.entities.add({
        position: Cesium.Cartesian3.fromDegrees(path[0].longitude, path[0].latitude, -21), // Set height to 0
        point: {
          pixelSize: 10,
          color: colors[index],
        },
        label: {
          text: `Worker ${index+1}`,
          fillColor: colors[index],
          showBackground: true,
          backgroundColor: Cesium.Color.WHITE.withAlpha(0.7),
          font: '14px sans-serif',
          style: Cesium.LabelStyle.FILL_AND_OUTLINE,
          verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
          pixelOffset: new Cesium.Cartesian2(0, -20),
        }
      }),
      path: path,
      currentPathIndex: 0
    }));
    
       viewer.entities.add({
        name : 'Hazardous Zone',
        polygon: {
            hierarchy: Cesium.Cartesian3.fromDegreesArrayHeights([
                -95.96642125759898, 30.36800931759473, 0,
                -95.96518215409967, 30.36783485434602, 0,
                -95.96531852602203, 30.36722017320753, 0,
                -95.96655762952125, 30.36738652293908, 0,
            ]),
            material : Cesium.Color.RED.withAlpha(0.5),
            outline : true,
            outlineColor : Cesium.Color.RED,
            height: 60.5
        }
    });

    // Function to update workers' positions
    function updateWorkersPositions() {
      workers.forEach(worker => {
        worker.currentPathIndex = (worker.currentPathIndex + 1) % worker.path.length;
        const position = worker.path[worker.currentPathIndex];
        worker.entity.position = Cesium.Cartesian3.fromDegrees(position.longitude, position.latitude, 61); // Set height to 0
      });

      viewer.scene.requestRender();
    }

    // Update workers' positions every 5 seconds
    setInterval(updateWorkersPositions, 5000);
  }
  </script>
</body>
</html>